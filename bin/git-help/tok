#!/usr/bin/env perl

use strict;
use feature qw(say state);

my $gitlab   = q();
my $github   = q(Qph_fRZlCXB3ZN2TpPrW67DmFYotmag9r1uBmHnc);
my $codeberg = q();

sub xcrypt {
    my $token = shift;
    my $inc   = sub { state $val = -1; $val == 9 ? q() : ++$val };

    local @ARGV = ("$ENV{HOME}/.kit");
    chomp( my $okey = <> );

    my $key  = join '', map { $_ . uc . $inc->() } split '', $okey;
    my $ekey = reverse $key;

    if ( $token =~ /^git(?:hub|lab)|codeberg$/ ) {
        eval "\$token = \${$token}; \$token =~ tr/$key/$ekey/";
    }
    else {
        eval "\$token =~ tr/$ekey/$key/";
    }

    say $token;
}

xcrypt @ARGV if $#ARGV == 0;
