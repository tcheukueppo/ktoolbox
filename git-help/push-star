#!/bin/sh

#
# Auto update remote repositories
#

if ! command -v git >/dev/null; then
	printf "ERR: git not found, where is it?\n" >&2
	exit 1
fi

if ! command -v tok >/dev/null; then
	printf "ERR: tok not found, where is it?\n" >&2
	exit 1
fi

for i in \
					projects/wfmux \
					projects/farbfeld-utils \
					projects/apriori \
					projects/kdmenu  \
					projects/kuttix \
					projects/learn \
					projects/gists \
					projects/ktoolbox \
					projects/conky.store \
					projects/kst \
					projects/kdwm \
					projects/ksent \
					projects/kslock \
					projects/kfetch \
					projects/kslstatus \
					projects/krit \
					projects/weeklychallenge \
					projects/sad \
					projects/myresources \
					projects/amonia \
					projects/orangebar \
					projects/herbe \
					projects/farbfeld-4 \
do
	repo_dir="$HOME/$i"

	if [ -d "$repo_dir" -a -d "$repo_dir/.git" ]
	then
		real_path="$(readlink -f "$repo_dir")"

		cd "$real_path"
		if [ $? -eq 0 ]
		then
			repo_name="${i##*/}"

			printf "Updating %s ...\n" "$repo_name"

			git branch | while read branch_name
			do
				branch_name="${branch_name#* }"

				printf "\tbranch: %s " "$branch_name"

				{
					# We don't want to force push, handle that on your own.
					git push -u "https://$(tok codeberg)@codeberg.org/tcheukueppo/$repo_name" "$branch_name"    &&
					git push -u "https://$(tok github)@github.com/tcheukueppo/$repo_name" "$branch_name"        &&
					git push -u "https://create:$(tok gitlab)@gitlab.com/tcheukueppo/$repo_name" "$branch_name"

				} >/dev/null 2>&1 && 

				printf "*\n" || printf "X\n"
			done

			printf "Done.\n"
		else
			printf "ERR: couldn't \`cd' to '%s'\n" "$real_path" >&2
			exit 1
		fi
	fi
done
