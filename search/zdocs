#!/usr/bin/env sh
#
# a simple script which finds for pdfs
# and open them with zathura pdf viewer

func_exit_with_status ()
{
	eval exit $1
}

command -v zathura >/dev/null 2>&1 || {
	printf 'install zathura first!'
	func_exit_with_status 1
}

pdf_dir='/mnt2/books'
case $# in
1)	test -d "$1" || {
		printf '%s: %s is not a directory' "$0" "$1"
		func_exit_with_status 1
	}
	pdf_dir="$1"
	;;
*)	printf '%s: run zdocs /path/to/dir/ ' "$0"
	;;
esac

cache="${XDG_HOME_CACHE:-"$HOME/.cache"}"
dcache="${cache}/zdocs"

pdf="$(find "$pdf_dir" -type f -iname '*.pdf' -print | tee "$dcache" | \
		while read base; do
			echo "$(basename "$base")"
		done | dmenu -c -i -l 10)"

if test -n "$pdf"; then
	# if there are PDFs having the same name
	# but found in different directories, then 
	# take the first one
	pdf="$(cat "$dcache" | grep "/$pdf$" | head -n1)"
	zathura "$pdf"
fi
